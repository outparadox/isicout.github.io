<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Do you know Dagger2? | Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="æ¦‚è¿°å¾ˆå¤šAndroid Appsé€šå¸¸ä¾èµ–äºå…¶ä»–ä¾èµ–åº“çš„å®ä¾‹åŒ–å¯¹è±¡, ä¸¾ä¾‹æ¥è¯´,  ä¸€ä¸ªTwitterå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨ç±»ä¼¼Retrofitçš„ç½‘ç»œä¾èµ–åº“æ¥è¿›è¡Œæ„å»º, è¦ä½¿ç”¨è¿™ä¸ªåº“, ä½ éœ€è¦æ·»åŠ è§£æçš„åº“ï¼Œæ¯”å¦‚è¯´Gson.  æ­¤å¤–,  é‚£äº›å®ç°è®¤è¯æˆ–è€…ç¼“å­˜çš„ç±»å¯èƒ½éœ€è¦è®¿é—®shared preferenceså’Œå…¶ä»–å…¬å…±çš„å­˜å‚¨å•å…ƒï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä»–ä»¬å¹¶ä¸”åˆ›å»ºå›ºæœ‰çš„ä¾èµ–é“¾.">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Do you know Dagger2?">
<meta property="og:url" content="http://yoursite.com/2017/05/02/Dagger2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="æ¦‚è¿°å¾ˆå¤šAndroid Appsé€šå¸¸ä¾èµ–äºå…¶ä»–ä¾èµ–åº“çš„å®ä¾‹åŒ–å¯¹è±¡, ä¸¾ä¾‹æ¥è¯´,  ä¸€ä¸ªTwitterå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨ç±»ä¼¼Retrofitçš„ç½‘ç»œä¾èµ–åº“æ¥è¿›è¡Œæ„å»º, è¦ä½¿ç”¨è¿™ä¸ªåº“, ä½ éœ€è¦æ·»åŠ è§£æçš„åº“ï¼Œæ¯”å¦‚è¯´Gson.  æ­¤å¤–,  é‚£äº›å®ç°è®¤è¯æˆ–è€…ç¼“å­˜çš„ç±»å¯èƒ½éœ€è¦è®¿é—®shared preferenceså’Œå…¶ä»–å…¬å…±çš„å­˜å‚¨å•å…ƒï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä»–ä»¬å¹¶ä¸”åˆ›å»ºå›ºæœ‰çš„ä¾èµ–é“¾.">
<meta property="og:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_general.png">
<meta property="og:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_qualifiers.png">
<meta property="og:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_scopes.png">
<meta property="og:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_dependency.png">
<meta property="og:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_subcomponent.png">
<meta property="og:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/subcomponent_builders.png">
<meta property="og:updated_time" content="2017-05-02T08:22:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Do you know Dagger2?">
<meta name="twitter:description" content="æ¦‚è¿°å¾ˆå¤šAndroid Appsé€šå¸¸ä¾èµ–äºå…¶ä»–ä¾èµ–åº“çš„å®ä¾‹åŒ–å¯¹è±¡, ä¸¾ä¾‹æ¥è¯´,  ä¸€ä¸ªTwitterå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨ç±»ä¼¼Retrofitçš„ç½‘ç»œä¾èµ–åº“æ¥è¿›è¡Œæ„å»º, è¦ä½¿ç”¨è¿™ä¸ªåº“, ä½ éœ€è¦æ·»åŠ è§£æçš„åº“ï¼Œæ¯”å¦‚è¯´Gson.  æ­¤å¤–,  é‚£äº›å®ç°è®¤è¯æˆ–è€…ç¼“å­˜çš„ç±»å¯èƒ½éœ€è¦è®¿é—®shared preferenceså’Œå…¶ä»–å…¬å…±çš„å­˜å‚¨å•å…ƒï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä»–ä»¬å¹¶ä¸”åˆ›å»ºå›ºæœ‰çš„ä¾èµ–é“¾.">
<meta name="twitter:image" content="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_general.png">
    

    
        <link rel="alternate" href="/" title="Hexo" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Hexo</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/WechatIMG2.jpeg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/WechatIMG2.jpeg" />
            <h2 id="name">PARADOX</h2>
            <h3 id="title">Android Java Kotlin Developer &amp; Designer ğŸŒ¹</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Singapore, Singapore</span>
            <a id="follow" target="_blank" href="https://github.com/isicout">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                3
                <span>posts</span>
            </div>
            <div class="article-info-block">
                3
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-Dagger2" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Do you know Dagger2?
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/05/02/Dagger2/">
            <time datetime="2017-05-02T06:13:26.000Z" itemprop="datePublished">2017-05-02</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Android/">Android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å¾ˆå¤šAndroid Appsé€šå¸¸ä¾èµ–äºå…¶ä»–ä¾èµ–åº“çš„å®ä¾‹åŒ–å¯¹è±¡, ä¸¾ä¾‹æ¥è¯´,  ä¸€ä¸ªTwitterå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨ç±»ä¼¼<a href="https://github.com/square/retrofit" target="_blank" rel="external">Retrofit</a>çš„ç½‘ç»œä¾èµ–åº“æ¥è¿›è¡Œæ„å»º, è¦ä½¿ç”¨è¿™ä¸ªåº“, ä½ éœ€è¦æ·»åŠ è§£æçš„åº“ï¼Œæ¯”å¦‚è¯´<a href="https://github.com/google/gson" target="_blank" rel="external">Gson</a>.  æ­¤å¤–,  é‚£äº›å®ç°è®¤è¯æˆ–è€…ç¼“å­˜çš„ç±»å¯èƒ½éœ€è¦è®¿é—®shared preferenceså’Œå…¶ä»–å…¬å…±çš„å­˜å‚¨å•å…ƒï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä»–ä»¬å¹¶ä¸”åˆ›å»ºå›ºæœ‰çš„ä¾èµ–é“¾.     </p>
<a id="more"></a>
<p>Dagger2 ä¸ºä½ åˆ†æè¿™äº›ä¾èµ–åº“, å¹¶ä¸”ç”Ÿæˆä»£ç ä»¥å¸®åŠ©æŠŠä»–ä»¬è¿æ¥åœ¨ä¸€èµ·, è™½ç„¶è¿˜æœ‰å…¶ä»–çš„Java ä¾èµ–æ³¨å…¥åº“, ä½†æ˜¯ä»–ä»¬çš„å¤§å¤šæ•°åœ¨ä¾èµ–XMLçš„æ—¶å€™æœ‰å¾ˆå¤šé™åˆ¶, åœ¨è¿è¡ŒæœŸé—´éœ€è¦éªŒè¯ä¾èµ–å…³ç³»çš„é—®é¢˜, æˆ–è€…åœ¨å¯åŠ¨æœŸé—´å¯¼è‡´æ€§èƒ½ä¸Šçš„æŸè€—,  Dagger 2çº¯ç²¹ä¾èµ–äºä½¿ç”¨Javaæ³¨é‡Šå¤„ç†å™¨å’Œç¼–è¯‘æ—¶æ£€æŸ¥æ¥åˆ†æå’ŒéªŒè¯ä¾èµ–æ€§. å®ƒè¢«è®¤ä¸ºæ˜¯è¿„ä»Šä¸ºæ­¢æ•ˆç‡æœ€é«˜çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ä¹‹ä¸€. </p>
<h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><p>è¿™é‡Œæœ‰ä½¿ç”¨Dagger2 çš„ä¸€äº›ä¼˜ç‚¹</p>
<ul>
<li><strong>ç®€åŒ–å¯¹å…±äº«å®ä¾‹çš„è®¿é—®.</strong> ä¸¾ä¾‹æ¥è¯´, æ­£å¦‚<a href="https://github.com/JakeWharton/butterknife" target="_blank" rel="external">ButterKnife</a>å£°æ˜å¯¹View, äº‹ä»¶å¤„ç†, èµ„æºçš„å¼•ç”¨æ›´ä¸ºç®€å•é‚£ç§, Dagger2ä¸ºè·å–å…±äº«å®ä¾‹çš„é¥®ç”¨æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼. æ¯”å¦‚,ä¸€æ—¦æˆ‘ä»¬åœ¨Daggerä¸­å£°æ˜ç±»ä¼¼<code>MyTwitterApiClient</code>æˆ–è€…<code>SharedPreferences</code>çš„å•ä¾‹çš„å¼•ç”¨, æˆ‘ä»¬å¯ä»¥ç®€å•çš„ä½¿ç”¨ <code>@Inject</code>æ³¨è§£æ¥å£°æ˜å­—æ®µ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">   <span class="meta">@Inject</span> MyTwitterApiClient mTwitterApiClient;</div><div class="line">   <span class="meta">@Inject</span> SharedPreferences sharedPreferences;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstance)</span> </span>&#123;</div><div class="line">       <span class="comment">// assign singleton instances to fields</span></div><div class="line">       InjectorClass.inject(<span class="keyword">this</span>);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><strong>æ›´å®¹æ˜“é…åˆ¶å¤æ‚çš„ä¾èµ–.</strong>  é‚£äº›ä½ ç»å¸¸åˆ›å»ºçš„å¯¹è±¡æœ‰ä¸€ä¸ªéšå¼çš„è¿‡ç¨‹. Dagger2 éå†ä¾èµ–å›¾è¡¨å¹¶ä¸”ç”Ÿæˆä»¥ä¾¿äºç†è§£ä¸”è¿½è¸ªä»£ç , åŒæ—¶æŠŠä½ ä»ç¼–å†™å¤§é‡çš„æ¨¡ç‰ˆä»£ç çš„å·¥ä½œä¸­è§£æ•‘å‡ºæ¥, ä½ æ­£å¸¸çš„éœ€è¦æ‰‹å·¥ç¼–å†™ä»£ç ä»¥è·å–å¼•ç”¨å¹¶å°†ä»–ä»¬ä½œä¸ºä¾èµ–ä¼ é€’ç»™å…¶ä»–å¯¹è±¡. å®ƒä¹Ÿæœ‰åŠ©äºç®€åŒ–é‡æ„, å› ä¸ºä»¥å¯ä»¥ä¸“æ³¨äºæ„å»ºå“ªäº›æ¨¡å—è€Œä¸æ˜¯å…³æ³¨äºä»–ä»¬è¢«åˆ›å»ºçš„é¡ºåº. </p>
</li>
<li><p><strong>å•å…ƒå’Œé›†æˆå˜å¾—æ›´ä¸ºè½»æ¾.</strong> å› ä¸ºä¾èµ–å›¾è¡¨æ˜¯ç”±æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„, æˆ‘ä»¬èƒ½å¤Ÿç®€å•çš„åˆ‡æ¢æ¨¡å—ï¼Œä½œå‡ºç½‘ç»œå“åº”å¹¶ä¸”æ¨¡æ‹Ÿè¿™ç§è¡Œä¸º </p>
</li>
<li><p><strong>å®ä¾‹ä½œç”¨åŸŸ.</strong> ä½ ä¸ä»…æ›´ä¸ºç®€å•çš„ç®¡ç†æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ, ä½ è¿˜å¯ä»¥åˆ©ç”¨Dagger2 å£°æ˜æ›´ä¸ºç®€çŸ­çš„ç”Ÿå‘½å‘¨æœŸçš„å®ä¾‹(æ¯”å¦‚, ç»‘å®šç”¨æˆ·çš„seesion, Activity çš„ç”Ÿå‘½å‘¨æœŸ, etc.). </p>
</li>
</ul>
<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><p>Android studioé€šå¸¸æƒ…å†µä¸‹ä¸ä¼šå…è®¸ä½ è¿æ¥åˆ°ç”ŸæˆDagger2çš„ä»£ç ä½œä¸ºåˆæ³•çš„ç±»,  å› ä¸ºä»–ä»¬é€šå¸¸æƒ…å†µä¸‹ä¸ä¼šæ·»åŠ åˆ°èµ„æºè·¯å¾„, ä½†æ˜¯é€šè¿‡æ·»åŠ <code>android-apt</code> æ’ä»¶èƒ½å¤Ÿæ·»åŠ è¿™äº›æ–‡ä»¶åˆ°IDEè·¯å¾„ï¼Œå¹¶ä¸”ä½¿ä½ å¯¹è¿™äº›æ–‡ä»¶æœ‰æ›´å¤šçš„å¯è§æ€§</p>
<p>ç”±äºAndroid Gradle plugin 2.2æ³¨é‡Šå¤„ç†æ˜¯å†…ç½®çš„, android-aptå¹¶ä¸è¢«å—å¾…è§. <code>android-apt</code>ä¸æ”¯æŒæ–°çš„ <code>jack</code> </p>
<p>åœ¨ä½ çš„<code>app/build.gradle</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹3è¡Œçš„ç”³è¯·è¯´æ˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    <span class="comment">// apt command comes from the android-apt plugin</span></div><div class="line">    apt <span class="string">'com.google.dagger:dagger-compiler:2.8'</span></div><div class="line">    compile <span class="string">'com.google.dagger:dagger:2.8'</span></div><div class="line">    provided <span class="string">'javax.annotation:jsr250-api:1.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨android gradle 2.3 æ’ä»¶, ä½ å¯ä»¥ä½¿ç”¨<code>annotationProcessor</code> æ¥ä»£æ›¿apt-plugin:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    <span class="comment">// apt command comes from the android-apt plugin</span></div><div class="line">    compile <span class="string">"com.google.dagger:dagger:2.9"</span></div><div class="line">    annotationProcessor <span class="string">"com.google.dagger:dagger-compiler:2.9"</span></div><div class="line">    provided <span class="string">'javax.annotation:jsr250-api:1.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¦æ³¨æ„çš„æ˜¯<code>provided</code>å…³é”®å­—ä»…ä»…åœ¨ç¼–è¯‘æœŸé—´è¢«ç”¨æ¥ä½œä¸ºä¾èµ–å…³ç³», Daggerç”Ÿæˆç”¨äºåˆ›å»ºæºä»£ç ä¸­å®šä¹‰çš„ç±»çš„ä¾èµ–å›¾çš„ä»£ç . è¿™äº›ç±»åœ¨ç¼–è¯‘æœŸé—´è¢«æ·»åŠ åˆ°IDEç±»è·¯å¾„ä¸­. <code>annotationProcessor</code>å…³é”®å­—è¢«Android gradleæ’ä»¶æ‰€è¯†åˆ«å¹¶ä¸”ä¸ä¼šæŠŠè¿™äº›ç±»ä»–ä»¬æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­, å®ƒä»¬ä»…ä»…è¢«ç”¨æ¥æ³¨é‡Šå¤„ç†, ä»¥é˜²æ­¢åˆ«äººæ„å¤–çš„å¼•ç”¨ä»–ä»¬. </p>
<h2 id="åˆ›å»ºå•ä¾‹"><a href="#åˆ›å»ºå•ä¾‹" class="headerlink" title="åˆ›å»ºå•ä¾‹"></a>åˆ›å»ºå•ä¾‹</h2><p><img src="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_general.png" alt="Creatint singletons"></p>
<p>å¾ˆç®€å•çš„ä¾‹å­è¡¨æ˜å¦‚ä½•ä½¿ç”¨Dagger2 é›†ä¸­ä½ æ‰€æœ‰åˆ›å»ºçš„å•ä¾‹.<br>ç±»ä¼¼äºä¸‹é¢è¿™æ ·, å‡è®¾åœ¨ä½ çš„Twitterå®¢æˆ·ç«¯ä¸­ä½ ä»æ²¡æœ‰ä½¿ç”¨è¿‡ä»»ä½•ç±»å‹çš„çš„ä¾èµ–æ³¨å…¥æ¡†æ¶å†™ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line"></div><div class="line"><span class="comment">// Enable caching for OkHttp</span></div><div class="line"><span class="keyword">int</span> cacheSize = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 10 MiB</span></div><div class="line">Cache cache = <span class="keyword">new</span> Cache(getApplication().getCacheDir(), cacheSize);</div><div class="line">client.setCache(cache);</div><div class="line"></div><div class="line"><span class="comment">// Used for caching authentication tokens</span></div><div class="line">SharedPreferences sharedPrefeences = PreferenceManager.getDefaultSharedPreferences(<span class="keyword">this</span>);</div><div class="line"></div><div class="line"><span class="comment">// Instantiate Gson</span></div><div class="line">Gson gson = <span class="keyword">new</span> GsonBuilder().create();</div><div class="line">GsonConverterFactory converterFactory = GsonConverterFactory.create(gson);</div><div class="line"></div><div class="line"><span class="comment">// Build Retrofit</span></div><div class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">                                .baseUrl(<span class="string">"https://api.github.com"</span>)</div><div class="line">                                .addConverterFactory(converterFactory)</div><div class="line">                                .client(client)  <span class="comment">// custom client</span></div><div class="line">                                .build();</div></pre></td></tr></table></figure>
<h2 id="å£°æ˜ä½ çš„å•ä¾‹"><a href="#å£°æ˜ä½ çš„å•ä¾‹" class="headerlink" title="å£°æ˜ä½ çš„å•ä¾‹"></a>å£°æ˜ä½ çš„å•ä¾‹</h2><p>ä½ éœ€è¦é€šè¿‡åˆ›å»ºä¸€ä¸ªDagger2 moudleæ¥æ˜ç¡®å“ªäº›å¯¹è±¡åº”è¯¥è¢«åŒ…å«ä½œä¸ºä¾èµ–é“¾çš„ä¸€éƒ¨åˆ†. ä¸¾ä¾‹æ¥è¯´, å¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ä¸€ä¸ªå•ç‹¬çš„<code>Retrofit</code>å•ä¾‹ç»‘å®šåˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ,  å¹¶ä¸”å¯¹æˆ‘ä»¬æ‰€æœ‰çš„activityå’Œfragmentéƒ½æ˜¯å¯ç”¨çš„, æˆ‘ä»¬é¦–å…ˆè¦è®©Dagger çŸ¥é“å¯ä»¥æä¾›ä¸€ä¸ª<code>Retrofit</code>å•ä¾‹</p>
<p>å› ä¸ºæˆ‘ä»¬å¸Œæœ›è®¾ç½®caching, æˆ‘ä»¬éœ€è¦ä¸€ä»½Application Contextä¸Šä¸‹æ–‡ç¯å¢ƒ. æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªDaggeræ¨¡å—<code>AppModule.java</code>å°†è¢«ç”¨æ¥æä¾›æ­¤å¼•ç”¨, æˆ‘ä»¬è¿˜éœ€è¦å£°æ˜å¸¦æœ‰<code>@Provides</code>æ³¨è§£çš„æ–¹æ³•æ¥å‘Šè¯‰Daggerè¿™ä¸ªæ–¹æ³•æ˜¯è¿”å›ç±»å‹ä¸º<code>Application</code>çš„æ„é€ å™¨: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;</div><div class="line"></div><div class="line">    Application mApplication;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AppModule</span><span class="params">(Application application)</span> </span>&#123;</div><div class="line">        mApplication = application;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@Singleton</span></div><div class="line">    <span class="function">Application <span class="title">providesApplication</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mApplication;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<code>NetModule.java</code>å¹¶ä¸”ä½¿ç”¨<code>@Module</code>æ ‡æ³¨çš„ç±»æ¥å‘Šè¯‰Daggeråœ¨å¯ç”¨æ–¹æ³•çš„èŒƒå›´å†…å¯»æ‰¾æ¥ä½œä¸ºå®ä¾‹çš„æä¾›è€…</p>
<p><code>@Singleton</code>æ³¨è§£åŒæ ·å‘Šè¯‰Daggerç¼–è¯‘å™¨è¿™ä¸ªå®ä¾‹åœ¨æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­åº”è¯¥ä»…ä»…è¢«åˆ›å»ºä¸€æ¬¡, åœ¨ä»¥ä¸‹çš„ä¾‹å­ä¸­, æˆ‘ä»¬æŒ‡å®š<code>SharedPreferences</code> <code>Gson</code> <code>Cache</code> <code>OkHttpClient</code> <code>Retrofit</code> ä½œä¸ºå¯ä»¥ç”¨ä½œä¾èµ–åˆ—è¡¨ä¸€éƒ¨åˆ†çš„è¿”å›ç±»å‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</div><div class="line"></div><div class="line">    String mBaseUrl;</div><div class="line"></div><div class="line">    <span class="comment">// Constructor needs one parameter to instantiate.  </span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NetModule</span><span class="params">(String baseUrl)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mBaseUrl = baseUrl;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Dagger will only look for methods annotated with @Provides</span></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@Singleton</span></div><div class="line">    <span class="comment">// Application reference must come from AppModule.class</span></div><div class="line">    <span class="function">SharedPreferences <span class="title">providesSharedPreferences</span><span class="params">(Application application)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> PreferenceManager.getDefaultSharedPreferences(application);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@Singleton</span></div><div class="line">    <span class="function">Cache <span class="title">provideOkHttpCache</span><span class="params">(Application application)</span> </span>&#123; </div><div class="line">        <span class="keyword">int</span> cacheSize = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 10 MiB</span></div><div class="line">        Cache cache = <span class="keyword">new</span> Cache(application.getCacheDir(), cacheSize);</div><div class="line">        <span class="keyword">return</span> cache;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Provides</span> </div><div class="line">   <span class="meta">@Singleton</span></div><div class="line">   <span class="function">Gson <span class="title">provideGson</span><span class="params">()</span> </span>&#123;  </div><div class="line">       GsonBuilder gsonBuilder = <span class="keyword">new</span> GsonBuilder();</div><div class="line">       gsonBuilder.setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES);</div><div class="line">       <span class="keyword">return</span> gsonBuilder.create();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Provides</span></div><div class="line">   <span class="meta">@Singleton</span></div><div class="line">   <span class="function">OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">(Cache cache)</span> </span>&#123;</div><div class="line">      OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">      client.setCache(cache);</div><div class="line">      <span class="keyword">return</span> client;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Provides</span></div><div class="line">   <span class="meta">@Singleton</span></div><div class="line">   <span class="function">Retrofit <span class="title">provideRetrofit</span><span class="params">(Gson gson, OkHttpClient okHttpClient)</span> </span>&#123;</div><div class="line">      Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">                .addConverterFactory(GsonConverterFactory.create(gson))</div><div class="line">                .baseUrl(mBaseUrl)</div><div class="line">                .client(okHttpClient)</div><div class="line">                .build();</div><div class="line">        <span class="keyword">return</span> retrofit;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™ä¸ªæ–¹æ³•å (i.e. provideGson(), provideRetrofit(), etc)å¯ä»¥èµ·ä»»ä½•å. ä½¿ç”¨<code>@Provides</code>æ³¨è§£çš„è¿”å›å€¼ç±»å‹è¢«ç”¨æ¥å°†æ­¤å®ä¾‹ä¸å…¶ä»–ä»»ä½•ç›¸åŒç±»å‹çš„moudleç›¸å…³è”, <code>@Singleton</code>æ³¨è§£è¢«ç”¨æ¥åƒDaggeræè¿°åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸæœŸé—´ä»…ä»…åˆå§‹åŒ–ä¸€æ¬¡</p>
<p><code>Retrofit</code>çš„å®ä¾‹çš„åŒæ—¶ä¾èµ–äº<code>Gson</code>å’Œ<code>OkHttpClient</code>å®ä¾‹, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªç±»ä¸­å£°æ˜å¦å¤–ä¸€ä¸ªæ–¹æ³•ä»¥è·å–è¿™ä¸¤ä¸ªç±»å‹. åœ¨è¿™ä¸ªæ–¹æ³•ä¸­<code>@Provides</code>æ³¨è§£å’Œè¿™ä¸¤ä¸ªå‚æ•°å°†ä¼šä½¿å¾—Dagger æ„è¯†åˆ°è¿™é‡Œæœ‰<code>Gson</code>å’Œ<code>OkHttpClient</code>çš„ä¾èµ–ä»¥åˆ›å»º<code>Retrofit</code>çš„å®ä¾‹</p>
<h2 id="å£°æ˜æ³¨å…¥ç›®æ ‡"><a href="#å£°æ˜æ³¨å…¥ç›®æ ‡" class="headerlink" title="å£°æ˜æ³¨å…¥ç›®æ ‡"></a>å£°æ˜æ³¨å…¥ç›®æ ‡</h2><p>Daggerä¸ºä½ çš„activitys, services, æˆ–fragmentsæä¾›äº†ä¸€ç§ç®€å•çš„é€šè¿‡ä½¿ç”¨<code>@Inject</code>æ³¨è§£æ³¨å…¥å­—æ®µå¹¶ä¸”è°ƒç”¨<code>inject()</code>æ–¹æ³•æ¥åˆ†é…å¼•ç”¨, è°ƒç”¨<code>inject()</code>æ–¹æ³•å°†ä¼šä½¿Dagger2 åœ¨ä¾èµ–å›¾è°±ä¸­å°è¯•å¯»æ‰¾ä¸€ä¸ªç›¸åŒ¹é…çš„è¿”å›ç±»å‹æ¥å®šä½å•ä¾‹. å¦‚æœæ‰¾åˆ°, å®ƒå°†åˆ†é…å„è‡ªå¯¹åº”å­—æ®µçš„å¼•ç”¨. æ¯”å¦‚, åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, å®ƒä¼šå°è¯•å¯»æ‰¾è¿”å›ç±»å‹ä¸º<code>MyTwitterApiClient</code>å’Œ<code>SharedPreferences</code>çš„æä¾›å™¨(provider)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">   <span class="meta">@Inject</span> MyTwitterApiClient mTwitterApiClient;</div><div class="line">   <span class="meta">@Inject</span> SharedPreferences sharedPreferences;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstance)</span> </span>&#123;</div><div class="line">       <span class="comment">// assign singleton instances to fields</span></div><div class="line">       InjectorClass.inject(<span class="keyword">this</span>);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>Dagger2 ä¸­ä½¿ç”¨çš„æ³¨å…¥å™¨ç±»è¢«ç§°ä¸º componentç»„ä»¶, å®ƒä¸ºæˆ‘ä»¬çš„activitys, services, æˆ–åˆ™fragmentsåˆ†é…å¼•ç”¨ä»¥è¿æ¥æˆ‘ä»¬ä¹‹å‰å£°æ˜çš„å•ä¾‹, æˆ‘ä»¬åŒæ ·éœ€è¦ä¸€ä¸ª<code>@Component</code>æ³¨è§£å£°æ˜çš„ç±», å¯ä»¥æ·»åŠ çš„activitys, services, æˆ–åˆ™fragmentsåº”è¯¥åœ¨è¿™ä¸ªç±»ä¸­å•ç‹¬çš„ä½¿ç”¨<code>inject()</code>æ–¹æ³•å£°æ˜:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules=&#123;AppModule.class, NetModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NetComponent</span> </span>&#123;</div><div class="line">   <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span></span>;</div><div class="line">   <span class="comment">// void inject(MyFragment fragment);</span></div><div class="line">   <span class="comment">// void inject(MyService service);</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™äº›ç±»å¹¶ä¸è¶³ä»¥ä½œä¸ºæ³¨å…¥çš„ç›®æ ‡, Dagger2 ä¾èµ–ç›¸åŒ¹é…çš„ç±», ä½ å¿…é¡»æ˜ç¡®æŒ‡æ˜é‚£ä¸ªç±»åº”è¯¥è¢«å£°æ˜åœ¨å†…, (è¿™é‡Œæœ‰ä¸€äº›<a href="https://blog.gouline.net/dagger-2-even-sharper-less-square-b52101863542#.vgmua0fkm" target="_blank" rel="external">å»ºè®®</a>æ¥è§£å†³è¿™ä¸ªé—®é¢˜, ä½†æ˜¯è¿™æ ·åšä»£ç å¯èƒ½è¿½è¸ªæ›´åŠ å›°éš¾ç›¸æ¯”ç®€å•çš„å®šä¹‰å®ƒä»¬ )</p>
<h2 id="ä»£ç ç”Ÿæˆ"><a href="#ä»£ç ç”Ÿæˆ" class="headerlink" title="ä»£ç ç”Ÿæˆ"></a>ä»£ç ç”Ÿæˆ</h2><p>ä¸€ä»¶é‡è¦Dagger2çš„æ–¹é¢æ˜¯, è¿™ä¸ªåº“ä¸ºæ ‡æ³¨äº†<code>@Component</code>çš„æ¥å£ç±»ç”Ÿæˆä»£ç , ä½ å¯ä»¥ä½¿ç”¨å‰ç¼€ä¸º<code>@Dagger</code>(i.e. DaggerTwitterApiComponent.java)çš„ç±», å®ƒå°†è´Ÿè´£å®ä¾‹åŒ–æˆ‘ä»¬çš„ä¾èµ–å›¾è°±ä¸­çš„ä¸€ä¸ªå®ä¾‹, å¹¶ä¸”ç”¨å®ƒæ‰§è¡Œ<code>@Inject</code>æ³¨è§£å­—æ®µçš„æ³¨å…¥å·¥ä½œ. è¯·çœ‹(setup guide)[<a href="https://github.com/codepath/android_guides/wiki/Dependency-Injection-with-Dagger-2#setup" target="_blank" rel="external">https://github.com/codepath/android_guides/wiki/Dependency-Injection-with-Dagger-2#setup</a>].</p>
<h2 id="å®ä¾‹åŒ–ç»„ä»¶"><a href="#å®ä¾‹åŒ–ç»„ä»¶" class="headerlink" title="å®ä¾‹åŒ–ç»„ä»¶"></a>å®ä¾‹åŒ–ç»„ä»¶</h2><p>æˆ‘ä»¬åº”è¯¥åœ¨<code>Application</code>çš„ç±»ä¸­åšæ‰€æœ‰å·¥ä½œ, å› ä¸ºè¿™äº›å®ä¾‹åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­ä»…ä»…è¢«å£°æ˜ä¸€æ¬¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> NetComponent mNetComponent;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line"></div><div class="line">        <span class="comment">// Dagger%COMPONENT_NAME%</span></div><div class="line">        mNetComponent = DaggerNetComponent.builder()</div><div class="line">                <span class="comment">// list of modules that are part of this component need to be created here too</span></div><div class="line">                .appModule(<span class="keyword">new</span> AppModule(<span class="keyword">this</span>)) <span class="comment">// This also corresponds to the name of your module: %component_name%Module</span></div><div class="line">                .netModule(<span class="keyword">new</span> NetModule(<span class="string">"https://api.github.com"</span>))</div><div class="line">                .build();</div><div class="line"></div><div class="line">        <span class="comment">// If a Dagger 2 component does not have any constructor arguments for any of its modules,</span></div><div class="line">        <span class="comment">// then we can use .create() as a shortcut instead:</span></div><div class="line">        <span class="comment">//  mNetComponent = com.codepath.dagger.components.DaggerNetComponent.create();</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> NetComponent <span class="title">getNetComponent</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> mNetComponent;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœä¸èƒ½æ²¡æœ‰Dagger componentç»„ä»¶çš„å¼•ç”¨, ä½ è¦ç¡®ä¿é‡æ„é¡¹ç›®(åœ¨AndroidStudioä¸­, select Build &gt; Rebuild Project)</p>
<p>å› ä¸ºæˆ‘ä»¬è¦†å†™äº†é»˜è®¤çš„<code>Application</code>ç±», æˆ‘ä»¬åŒæ ·ä¿®æ”¹åº”ç”¨ç¨‹åº<code>name</code>ä¸º<code>MyApp</code>, è¿™æ ·, ä½ çš„åº”ç”¨ç¨‹åºå°†ä½¿ç”¨è¿™ä¸ªApplicaiton ç±»æ¥å¤„ç†æœ€åˆçš„å®ä¾‹. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;application</div><div class="line">      android:allowBackup=<span class="string">"true"</span></div><div class="line">      android:name=<span class="string">".MyApp"</span>&gt;</div></pre></td></tr></table></figure>
<p>åœ¨æˆ‘ä»¬Activityçš„å†…éƒ¨, æˆ‘ä»¬åªéœ€è¦è°ƒç”¨<code>inject()</code>æ–¹æ³•å°±å¯ä»¥ç®€å•çš„è®¿é—®è¿™äº›ç»„ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">  <span class="meta">@Inject</span> OkHttpClient mOkHttpClient;</div><div class="line">  <span class="meta">@Inject</span> SharedPreferences sharedPreferences;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstance)</span> </span>&#123;</div><div class="line">        <span class="comment">// assign singleton instances to fields</span></div><div class="line">        <span class="comment">// We need to cast to `MyApp` in order to get the right method</span></div><div class="line">        ((MyApp) getApplication()).getNetComponent().inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="é™åˆ¶ç±»å‹"><a href="#é™åˆ¶ç±»å‹" class="headerlink" title="é™åˆ¶ç±»å‹"></a>é™åˆ¶ç±»å‹</h2><p><img src="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_qualifiers.png" alt="Qualified types"></p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦åŒä¸€è¿”å›ç±»å‹çš„ä¸¤ä¸ªä¸åŒå¯¹è±¡, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@Named</code>é™å®šæ³¨è§£, ä½ éœ€è¦åœ¨ä½ æä¾›å•ä¾‹çš„åœ°æ–¹(<code>@Provides</code> annotation)å’Œæ³¨å…¥å®ƒä»¬çš„åœ°æ–¹(<code>@Inject</code> annotations)åŒæ—¶å£°æ˜å®ƒä»¬:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Provides</span> <span class="meta">@Named</span>(<span class="string">"cached"</span>)</div><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="function">OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">(Cache cache)</span> </span>&#123;</div><div class="line">    OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">    client.setCache(cache);</div><div class="line">    <span class="keyword">return</span> client;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Provides</span> <span class="meta">@Named</span>(<span class="string">"non_cached"</span>) <span class="meta">@Singleton</span></div><div class="line"><span class="function">OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</div><div class="line">    OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">    <span class="keyword">return</span> client;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å½“ä½ æ³¨å…¥è¿™äº›å•ä¾‹çš„æ—¶å€™, ä½ åŒæ ·éœ€è¦<code>@Named</code>æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Inject</span> <span class="meta">@Named</span>(<span class="string">"cached"</span>) OkHttpClient client;</div><div class="line"><span class="meta">@Inject</span> <span class="meta">@Named</span>(<span class="string">"non_cached"</span>) OkHttpClient client2;</div></pre></td></tr></table></figure>
<p><code>@Named</code>æ˜¯Daggeré¢„å…ˆå®šä¹‰çš„é™å®šæ³¨è§£, ä½ å¯ä»¥å¾ˆå¥½çš„åˆ›å»ºä½ è‡ªå·±çš„é™å®šæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Qualifier</span></div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DefaultPreferences &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h2><p><img src="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_scopes.png" alt="Scopes"></p>
<p>åœ¨Dagger2, ä½ å¯ä»¥å£°æ˜Componentç»„ä»¶é€šè¿‡å£°æ˜è‡ªå®šä¹‰çš„èŒƒå›´å¦‚ä½•å°è£…. ä¸¾ä¾‹æ¥è¯´, ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä»…ä»…åœ¨activityæˆ–è€…fragmentç”Ÿå‘½å‘¨æœŸè¿è¡ŒæœŸé—´çš„ä½œç”¨åŸŸ. ä½ å¯ä»¥åˆ›å»ºåªæ˜ å°„åˆ°ç”¨æˆ·èº«ä»½éªŒè¯ä¼šè¯çš„ä½œç”¨åŸŸ. </p>
<p>åˆ©ç”¨ä½œç”¨åŸŸå…è®¸æˆ‘ä»¬è¦ä¹ˆåˆ›å»ºä¾èµ–ç»„ä»¶è¦ä¹ˆåˆ›å»ºå­ç»„ä»¶, ä¸Šé¢çš„ä¾‹å­è¡¨æ˜æˆ‘ä»¬æ‰€ä½¿ç”¨çš„<code>@Singleton</code>æ³¨è§£æ˜¯ä¼´éšåº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ, æˆ‘ä»¬åŒæ ·ä¾èµ–äºä¸€ä¸ªä¸»è¦çš„Dagger componentç»„ä»¶.</p>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªå¹¶ä¸éœ€è¦å¸¸é©»å†…å­˜ä¸­çš„å¤šä¸ªComponentç»„ä»¶(i.e. ä¾èµ–äºactivityæˆ–è€…fragmentç”Ÿå‘½å‘¨æœŸ, ç”šè‡³ä¾èµ–äºç”¨æˆ·çš„ç™»å½•çŠ¶æ€çš„Componentç»„ä»¶), æˆ‘ä»¬å¯ä»¥åˆ›å»ºç›¸å…³çš„ç»„ä»¶æ´»ç€å­ç»„ä»¶, åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹, éƒ½ä¼šä¸ºä½ å°è£…ä»£ç æä¾›ä¸€ç§æ–¹å¼. æˆ‘ä»¬å°†åœ¨ä¸‹æ–‡ä¸­çœ‹åˆ°å¦‚ä½•åŒæ—¶ä½¿ç”¨å®ƒä»¬. </p>
<p>è¿™é‡Œæœ‰ä½¿ç”¨è¿™äº›æ–¹æ³•çš„å‡ ç‚¹è€ƒè™‘:</p>
<ul>
<li><strong>ç›¸å…³çš„ç»„ä»¶è¦æ±‚çˆ¶ç»„ä»¶æ˜ç¡®åˆ—å‡ºå“ªäº›ä¾èµ–å¯ä»¥æ³¨å…¥, è€Œå­ç»„ä»¶æ²¡æœ‰</strong> å¯¹äºçˆ¶ç»„ä»¶æ¥è¯´, ä½ éœ€è¦é€šè¿‡æŒ‡æ˜ç±»å‹å’Œæ–¹æ³•, ä»¥æƒ³å­ç»„ä»¶æš´éœ²å®ƒä»¬</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// parent component</span></div><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules=&#123;AppModule.class, NetModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NetComponent</span> </span>&#123;</div><div class="line">    <span class="comment">// remove injection methods if downstream modules will perform injection</span></div><div class="line"></div><div class="line">    <span class="comment">// downstream components need these exposed</span></div><div class="line">    <span class="comment">// the method name does not matter, only the return type</span></div><div class="line">    <span class="function">Retrofit <span class="title">retrofit</span><span class="params">()</span></span>; </div><div class="line">    <span class="function">OkHttpClient <span class="title">okHttpClient</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">SharedPreferences <span class="title">sharedPreferences</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœä½ å¿˜è®°æ·»åŠ è¿™è¡Œä»£ç , ä½ å°†è¦çœ‹åˆ°ä¸€ä¸ªå…³äºæ³¨å…¥ç›®æ ‡ä¸¢å¤±çš„é”™è¯¯. ç±»ä¼¼äºprivate/publicå˜é‡å¦‚ä½•å»ç®¡ç†é‚£æ ·, ä½¿ç”¨çˆ¶componentç»„ä»¶å…è®¸æ›´æ˜ç¡®çš„æ§åˆ¶ä»¥åŠæ›´å¥½çš„å°è£…, ä½†æ˜¯ä½¿ç”¨å­componentç»„ä»¶ä½¿å¾—ä¾èµ–æ³¨å…¥åœ¨èŠ±è´¹çš„ä»£ä»·ä¸Šæ›´ä¸ºç®€å•</p>
<ul>
<li><strong>ä¸¤ä¸ªç›¸äº’ä¾èµ–çš„ç»„ä»¶ä¸èƒ½å…±äº«åŒä¸€èŒƒå›´.</strong> ä¸¾ä¾‹æ¥è¯´, ä¸¤ä¸ªç»„ä»¶ä¸èƒ½åŒæ—¶ä½¿ç”¨ <code>@Singleton</code>æ³¨è§£ æ ‡æ³¨ä½œç”¨åŸŸ, è¿™ä¸ªé™åˆ¶æ˜¯æœ‰<a href="https://github.com/google/dagger/issues/107#issuecomment-71073298" target="_blank" rel="external">è¿™é‡Œ</a>æè¿°çš„åŸå› å¯¼è‡´çš„, ç›¸å…³çš„ç»„ä»¶éœ€è¦å®šä¹‰å®ƒä»¬è‡ªå·±çš„èŒƒå›´.</li>
</ul>
<h2 id="ä¾èµ–ç»„ä»¶"><a href="#ä¾èµ–ç»„ä»¶" class="headerlink" title="ä¾èµ–ç»„ä»¶"></a>ä¾èµ–ç»„ä»¶</h2><p><img src="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_dependency.png" alt="Dependent Components"></p>
<p>ä¸¾ä¾‹æ¥è¯´, å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ ç”¨æˆ·ä¼šè¯çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ<br>æˆ‘ä»¬å¯ä»¥å£°æ˜æˆ‘ä»¬è‡ªå·±çš„ <code>@UserScope</code>æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</div><div class="line"><span class="keyword">import</span> javax.inject.Scope;</div><div class="line"></div><div class="line"><span class="meta">@Scope</span></div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UserScope &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶å, æˆ‘ä»¬å£°æ˜å®ƒçš„çˆ¶ç»„ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules=&#123;AppModule.class, NetModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NetComponent</span> </span>&#123;</div><div class="line">    <span class="comment">// downstream components need these exposed with the return type</span></div><div class="line">    <span class="comment">// method name does not really matter</span></div><div class="line">    <span class="function">Retrofit <span class="title">retrofit</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æ¥ç€å£°æ˜å®ƒçš„å­ç»„ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@UserScope</span> <span class="comment">// using the previously defined scope, note that @Singleton will not work</span></div><div class="line"><span class="meta">@Component</span>(dependencies = NetComponent.class, modules = GitHubModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‡è®¾ä¸‹é¢çš„Githubæ¨¡å—ç®€å•çš„è¿”å›ä¸€ä¸ªGithub Apiçš„æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GitHubModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubApiInterface</span> </span>&#123;</div><div class="line">      <span class="meta">@GET</span>(<span class="string">"/org/&#123;orgName&#125;/repos"</span>)</div><div class="line">      Call&lt;ArrayList&lt;Repository&gt;&gt; getRepository(<span class="meta">@Path</span>(<span class="string">"orgName"</span>) String orgName);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@UserScope</span> <span class="comment">// needs to be consistent with the component scope</span></div><div class="line">    <span class="function"><span class="keyword">public</span> GitHubApiInterface <span class="title">providesGitHubInterface</span><span class="params">(Retrofit retrofit)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> retrofit.create(GitHubApiInterface.class);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸ºäº†<code>GitHubModule.java</code>è·å¾—<code>Retrofit</code>å®ä¾‹çš„å¼•ç”¨, æˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨å®ƒä¹‹å‰çš„ç»„ä»¶ä¸­æ˜ç¡®å®šä¹‰å®ƒä»¬, å¦‚æœè¯´åœ¨å®ƒä¹‹åæ‰§è¡Œæ³¨å…¥, å®ƒä»¬åº”è¯¥åœ¨ä¹‹åçš„ç»„ä»¶ä¸­ç§»é™¤å®ƒä»¬:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules=&#123;AppModule.class, NetModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NetComponent</span> </span>&#123;</div><div class="line">    <span class="comment">// remove injection methods if downstream modules will perform injection</span></div><div class="line"></div><div class="line">    <span class="comment">// downstream components need these exposed</span></div><div class="line">    <span class="function">Retrofit <span class="title">retrofit</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">OkHttpClient <span class="title">okHttpClient</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">SharedPreferences <span class="title">sharedPreferences</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åä¸€æ­¥æ˜¯ä½¿ç”¨<code>GitHubComponent</code> æ‰§è¡Œå®ä¾‹åŒ–, è¿™ä¸ªæ—¶å€™, æˆ‘ä»¬é¦–å…ˆéœ€è¦æ„å»º<code>NetComponent</code>, å¹¶ä¸”åœ¨<code>DaggerGitHubComponent</code> builderçš„æ„é€ å‡½æ•°ä¸­ä¼ é€’å®ƒ: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NetComponent mNetComponent = DaggerNetComponent.builder()</div><div class="line">                .appModule(<span class="keyword">new</span> AppModule(<span class="keyword">this</span>))</div><div class="line">                .netModule(<span class="keyword">new</span> NetModule(<span class="string">"https://api.github.com"</span>))</div><div class="line">                .build();</div><div class="line"></div><div class="line">GitHubComponent gitHubComponent = DaggerGitHubComponent.builder()</div><div class="line">                .netComponent(mNetComponent)</div><div class="line">                .gitHubModule(<span class="keyword">new</span> GitHubModule())</div><div class="line">                .build();</div></pre></td></tr></table></figure>
<p><a href="https://github.com/codepath/dagger2-example" target="_blank" rel="external">this example code </a></p>
<p>å­ç»„ä»¶</p>
<p><img src="https://raw.githubusercontent.com/codepath/android_guides/master/images/dagger_subcomponent.png" alt="Subcomponents"></p>
<p>ä½¿ç”¨å­ç»„ä»¶æ˜¯æ‰©å±•ç»„ä»¶çš„å¯¹è±¡å›¾çš„å¦å¤–ä¸€ç§æ–¹å¼, å°±åƒä¾èµ–çš„ç»„ä»¶é‚£æ ·, å­ç»„ä»¶æœ‰å®ƒä»¬è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸”å½“æ‰€æœ‰å­ç»„ä»¶çš„å¼•ç”¨éƒ½æ¶ˆå¤±çš„æ—¶å€™æ˜¯å¯ä»¥è¢«åƒåœ¾æ”¶é›†çš„, å¹¶å…·æœ‰ç›¸åŒçš„èŒƒå›´é™åˆ¶ã€‚åœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œä¸éœ€è¦å®šä¹‰æ‰€æœ‰ä¸‹æ¸¸ç»„ä»¶. </p>
<p>å¦ä¸€ä¸ªä¸»è¦çš„ä¸åŒä¹‹å¤„å°±æ˜¯å­ç»„ä»¶åªéœ€è¦åœ¨çˆ¶ç»„ä»¶ä¸­å£°æ˜. </p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªä¸ºActivityä½¿ç”¨å­ç»„ä»¶çš„ä¾‹å­. æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰çš„èŒƒå›´å’Œ<code>@Subcomponent</code>æ³¨è§£æ ‡æ³¨ä¸€ä¸ªç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MyActivityScope</span></div><div class="line"><span class="meta">@Subcomponent</span>(modules=&#123; MyActivityModule.class &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyActivitySubComponent</span> </span>&#123;</div><div class="line">    <span class="meta">@Named</span>(<span class="string">"my_list"</span>) <span class="function">ArrayAdapter <span class="title">myListAdapter</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>moudleæ¨¡å—ä½¿ç”¨ä¸‹é¢å£°æ˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyActivityModule</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyActivity activity;</div><div class="line"></div><div class="line">    <span class="comment">// must be instantiated with an activity</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyActivityModule</span><span class="params">(MyActivity activity)</span> </span>&#123; <span class="keyword">this</span>.activity = activity; &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span> <span class="meta">@MyActivityScope</span> <span class="meta">@Named</span>(<span class="string">"my_list"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ArrayAdapter <span class="title">providesMyListAdapter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(activity, android.R.layout.my_list);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€å, åœ¨çˆ¶ç»„ä»¶ä¸­, æˆ‘ä»¬å£°æ˜ä¸€ä¸ªå·¥å‚æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules=&#123; ... &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyApplicationComponent</span> </span>&#123;</div><div class="line">    <span class="comment">// injection targets here</span></div><div class="line"></div><div class="line">    <span class="comment">// factory method to instantiate the subcomponent defined here (passing in the module instance)</span></div><div class="line">    <span class="function">MyActivitySubComponent <span class="title">newMyActivitySubcomponent</span><span class="params">(MyActivityModule activityModule)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, <code>newMyActivitySubcomponent()</code>æ¯æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™, ä¸€ä¸ªæ–°çš„å­ç»„ä»¶çš„å®ä¾‹éƒ½ä¼šè¢«åˆ›å»º, ä½¿ç”¨å­æ¨¡å—moudleæ³¨å…¥åˆ°ä¸€ä¸ªactivity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules=&#123; ... &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyApplicationComponent</span> </span>&#123;</div><div class="line">    <span class="comment">// injection targets here</span></div><div class="line"></div><div class="line">    <span class="comment">// factory method to instantiate the subcomponent defined here (passing in the module instance)</span></div><div class="line">    <span class="function">MyActivitySubComponent <span class="title">newMyActivitySubcomponent</span><span class="params">(MyActivityModule activityModule)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å­ç»„ä»¶åˆ›å»º</p>
<p><img src="https://raw.githubusercontent.com/codepath/android_guides/master/images/subcomponent_builders.png" alt="Available starting in v2.7"></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/05/02/Dagger2/" data-id="cj28otgrj0000kv5jnd3u90ym" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/05/02/Dagger2/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2017/05/02/Dagger2/">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/05/02/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    Hello World
                
            </div>
        </a>
    
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/02/Ndk/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.pinterest.com/pin/419890365235460556/)" alt="NDK in Android" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/05/02/Ndk/" class="title">NDK in Android</a></p>
                            <p class="item-date"><time datetime="2017-05-02T08:36:41.000Z" itemprop="datePublished">2017-05-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/02/hello-world/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/05/02/hello-world/" class="title">Hello World</a></p>
                            <p class="item-date"><time datetime="2017-05-02T07:12:29.000Z" itemprop="datePublished">2017-05-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/02/Dagger2/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/05/02/Dagger2/" class="title">Do you know Dagger2?</a></p>
                            <p class="item-date"><time datetime="2017-05-02T06:13:26.000Z" itemprop="datePublished">2017-05-02</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JNI/">JNI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NDK/">NDK</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/JNI/" style="font-size: 10px;">JNI</a> <a href="/tags/NDK/" style="font-size: 10px;">NDK</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 John Doe<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'http://yoursite.com/2017/05/02/Dagger2/';
        
        this.page.identifier = 'Dagger2';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'hexo-theme-icarus' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>