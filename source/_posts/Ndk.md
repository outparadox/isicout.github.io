---
title: NDK in Android
date: 2017-05-02 16:36:41
tags: [NDK, JNI, Android]
thumbnail: https://www.pinterest.com/pin/419890365235460556/
---

Android NDK  简单来说就是可以让你的应用使用natice-code语言, （比如C ,C++)的工具集

一：what is the ndk 

 Ndk 是允许你在你的工程中可以使用native-code (比如C or c++)的工具, 你可以利用ndk来构建你的natice-app
 正如我们知道的那样, Java 是构建android app 的默认语言, 然而, java 代码很容易被反编译, 但是这对C++ code 来说这并不简单, 并且c++ 代码更加高效

二：why is ndk

C++ 代码反编译困难 

对于计算复杂量大的代码, C or C++ code can increase the performance of your app

三：buliding native app

如果你使用android studio 开发, 你需要下载安装ndk包, More info: [NDK](https://developer.android.com/ndk/downloads/index.html?hl=zh-cn)

1, 首先在代码中声明要在C++ code中要实现的native方法

``` java


/**
 * auth:huanjulu
 */

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);
        ((TextView) findViewById(R.id.text)).setText(nativeMethod());
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.menu_main, menu);
        return true;
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        // Handle action bar item clicks here. The action bar will
        // automatically handle clicks on the Home/Up button, so long
        // as you specify a parent activity in AndroidManifest.xml.
        int id = item.getItemId();

        //noinspection SimplifiableIfStatement
        if (id == R.id.action_settings) {
            return true;
        }

        return super.onOptionsItemSelected(item);
    }
    /**
     * native code
     *
     * @return
     */
    public native String nativeMethod();

}


```

2, 对包含`native` 关键字方法的类, 生成`.h` 头文件

进入到本地Java文件夹下 ,在Terminal input the follow commond

``` java

 javah -d ../jni jniproject.ndkproject.MainActivity
```

first , `jniproject.ndkproject` is your package name  and `MainActivity` is the class name that contains native code

and after that , you can see the `.h` file of  `MainActivity` class , it looks like :

![Qualified types](http://opd7g7we7.bkt.clouddn.com/WX20170503-154642.png)

and we can looks what contents it contains

``` java
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class jniproject_ndkproject_MainActivity */

#ifndef _Included_jniproject_ndkproject_MainActivity
#define _Included_jniproject_ndkproject_MainActivity
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     jniproject_ndkproject_MainActivity
 * Method:    nativeMethod
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_jniproject_ndkproject_MainActivity_nativeMethod
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

```









